<!doctype html>
<html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Preparando download...</title>
<link rel="stylesheet" href="/css/style.css"/>
</head><body>
  <main>
    <h1 id="title">Preparando o download...</h1>
    <div id="ad" class="ad-slot">Carregando anúncio...</div>
    <p>Você será redirecionado em <span id="timer">5</span>s</p>
    <p><a id="go" class="btn">Ir agora</a></p>
  </main>

  <script src="/js/app.js"></script>
  <script>
    (async function(){
      const id = location.pathname.split('/').pop();
      const bResp = await fetch('/api/books/' + id);
      if(!bResp.ok){ document.getElementById('title').innerText = 'Livro não encontrado'; return; }
      const b = await bResp.json();
      document.getElementById('title').innerText = b.title;
      const adResp = await fetch('/api/admin/settings/adscript');
      let adScript = '';
      if(adResp.ok){ const j = await adResp.json(); adScript = j.adScript || ''; }
      if(adScript) document.getElementById('ad').innerHTML = adScript;
      const timerEl = document.getElementById('timer');
      const go = document.getElementById('go');
      go.href = '/api/download/' + id;
      // t pode ser passado via query ?t= ou usa o valor padrão
      let t = Number(new URLSearchParams(location.search).get('t')) || 5;
      timerEl.innerText = t;
      const iv = setInterval(()=>{
        t--;
        timerEl.innerText = t;
        if (t <= 0) { clearInterval(iv); location.href = go.href; }
      }, 1000);
    })();
  </script>
</body></html>